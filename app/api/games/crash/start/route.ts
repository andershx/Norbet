import { NextRequest, NextResponse } from "next/server"; import { getSession } from "@/lib/auth"; import { readDB, writeDB } from "@/lib/demo-db"; import { crashPoint } from "@/lib/provablyFair";
export async function POST(req: NextRequest){ const { wager=1 } = await req.json(); const s = getSession(); const db = readDB(); const u = db.users[s.uid] || { id:s.uid, balance:100, vipPoints:0, clientSeed:'client' }; db.users[s.uid]=u; db.nonce=(db.nonce||0)+1; const point = crashPoint(db.serverSeed, u.clientSeed||'client', db.nonce); u.balance -= wager; writeDB(db); return NextResponse.json({ point, nonce: db.nonce }); }
